# Синтаксис "new Function"

#### [Синтаксис "new Function"](https://learn.javascript.ru/new-function)

Существует ещё один вариант объявлять функции. Он используется крайне редко, но иногда другого решения не найти.

### Синтаксис

Синтаксис для объявления функции:

    let func = new Function([arg1, arg2, ...argN], functionBody);
    let sum = new Function('a', 'b', 'return a + b');
    alert( sum(1, 2) ); // 3

Главное отличие от других способов объявления функции, которые были рассмотрены ранее, заключается в том, что функция
создаётся полностью «на лету» из строки, переданной во время выполнения.

Но `new Function` позволяет превратить любую строку в функцию. Например, можно получить новую функцию с сервера и затем
выполнить её:

    let str = ... код, полученный с сервера динамически ...
    
    let func = new Function(str);
    func();

Это используется в очень специфических случаях, например, когда мы получаем код с сервера для динамической компиляции
функции из шаблона, в сложных веб-приложениях.

### Замыкание

Но когда функция создаётся с использованием `new Function`, в её `[[Environment]]` записывается ссылка не на внешнее
лексическое окружение, в котором она была создана, а на глобальное. Поэтому такая функция имеет доступ только к
глобальным переменным.

    function getFunc() {
        let value = "test";
        
        let func = new Function('alert(value)');
        
        return func;
    }
    
    getFunc()(); // ошибка: value не определено

Сравним это с обычным объявлением:

    function getFunc() {
        let value = "test";
        
        let func = function() { alert(value); };
        
        return func;
    }
    
    getFunc()(); // "test", из лексического окружения функции getFunc

**Если бы new Function имела доступ к внешним переменным, при этом были бы проблемы с минификаторами.**

Эти 3 объявления ниже эквивалентны:

    new Function('a', 'b', 'return a + b'); // стандартный синтаксис
    new Function('a,b', 'return a + b'); // через запятую в одной строке
    new Function('a , b', 'return a + b'); // через запятую с пробелами в одной строке


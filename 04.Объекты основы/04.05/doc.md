# Конструкторы, создание объектов через "new"

#### [Конструкторы, создание объектов через "new"](https://learn.javascript.ru/constructor-new)

### Функция-конструктор

Функции-конструкторы являются обычными функциями. Но есть два соглашения:

Имя функции-конструктора должно начинаться с большой буквы.
Функция-конструктор должна вызываться при помощи оператора `new`.
Например:

    function User(name) {
        this.name = name;
        this.isAdmin = false;
    }
    
    let user = new User("Вася");
    
    alert(user.name); // Вася
    alert(user.isAdmin); // false

Когда функция вызывается как new User(...), происходит следующее:

1. Создаётся новый пустой объект, и он присваивается `this`.
2. Выполняется код функции. Обычно он модифицирует `this`, добавляет туда новые свойства.
3. Возвращается значение `this`.

Другими словами, вызов new User(...) делает примерно вот что:

    function User(name) {
        // this = {};  (неявно)
        
        // добавляет свойства к this
        this.name = name;
        this.isAdmin = false;
        
        // return this;  (неявно)
    }

**new function() { … }**

Если в нашем коде большое количество строк, создающих один сложный объект, мы можем обернуть их в функцию-конструктор
следующим образом:

    let user = new function() {
        this.name = "Вася";
        this.isAdmin = false;
        
        // ...другой код для создания пользователя
        // возможна любая сложная логика и выражения
        // локальные переменные и т. д.
    };

Такой конструктор не может быть вызван дважды, так как он нигде не сохраняется, просто создаётся и тут же вызывается.
Таким образом, такой метод создания позволяет инкапсулировать код, который создаёт отдельный объект, но без возможности
его повторного использования.

### Возврат значения из конструктора return

Обычно конструкторы ничего не возвращают явно. Их задача – записать все необходимое в `this`, который в итоге станет
результатом.

Но если `return` всё же есть, то применяется простое правило:

- При вызове `return` с объектом, будет возвращён объект, а не `this`.
- При вызове `return` с примитивным значением, примитивное значение будет отброшено.
  Другими словами, `return` с объектом возвращает объект, в любом другом случае конструктор вернёт `this`.

В примере ниже `return` возвращает объект вместо `this`:

    function BigUser() {
        this.name = "Вася";
        return { name: "Godzilla" }; // <-- возвращает этот объект
    }
    
    alert( new BigUser().name ); // Godzilla, получили этот объект

### Создание методов в конструкторе

В this мы можем добавлять не только свойства, но и методы.

Например, в примере ниже, `new User(name)` создаёт объект с данным именем name и методом `sayHi`:

    function User(name) {
        this.name = name;
        
        this.sayHi = function() {
        alert( "Меня зовут: " + this.name );
        };
        }
        
        let vasya = new User("Вася");
        
        vasya.sayHi(); // Меня зовут: Вася
        
        /*
        vasya = {
        name: "Вася",
        sayHi: function() { ... }
        }
    */

